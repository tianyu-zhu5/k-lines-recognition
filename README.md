# K线形态识别系统

基于 Streamlit + ECharts 的股票K线形态识别与可视化系统

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行

```bash
streamlit run streamlit_app.py
```

访问 http://localhost:8501 使用系统

## 模块说明

- `streamlit_app.py` - 主应用程序（支持分类筛选和颜色显示）
- `data_loader.py` - 数据加载模块
- `patterns.py` - K线形态识别库（28种形态）
- `stock_info.py` - 股票信息管理

## 支持的形态（28种）

### 🟢 底部反转信号（12种）
强烈看涨信号，预示价格可能见底回升
- **早晨之星** - 看涨反转信号（强）
- **早晨十字星** - 强烈看涨反转信号（强）
- **曙光初现** - 看涨反转信号（强）
- **旭日东升** - 强烈看涨反转信号（强）
- **连续跳空三阴线** - 强烈见底信号（强）
- **穿头破脚(看涨)** - 买进信号（强）
- **好友反攻** - 看涨信号（中等）
- **锤子线** - 看涨反转信号（中等）
- **倒锤子** - 看涨反转信号（中等）
- **低档五阳线** - 见底信号（中等）
- **两红夹一黑** - 反转信号（中等）
- **身怀六甲(看涨)** - 买进信号（中等）

### 🟩 持续上涨信号（2种）
预示价格将继续上涨
- **红三兵** - 持续上涨信号（强）
- **跳空上扬** - 持续上涨信号（强）

### 🔴 顶部反转信号（13种）
预示价格可能见顶回落
- **黄昏之星** - 看跌反转信号（强）
- **黄昏十字星** - 强烈看跌反转信号（强）
- **乌云盖顶** - 看跌反转信号（强）
- **倾盆大雨** - 强烈看跌反转信号（强）
- **射击之星** - 看跌反转信号（强）
- **穿头破脚(看跌)** - 卖出信号（强）
- **吊颈线** - 看跌反转信号（中等）
- **平顶** - 看跌反转信号（中等）
- **高档五阴线** - 见顶信号（中等）
- **两黑夹一红** - 见顶信号（中等）
- **身怀六甲(看跌)** - 卖出信号（中等）
- **淡友反攻** - 见顶信号（中等）
- *(注：射击之星已包含在内)*

### 🟥 持续下跌信号（1种）
预示价格将继续下跌
- **黑三鸦** - 持续下跌信号（强）

### 🔵 支撑信号（1种）
支撑位标志
- **平底** - 支撑信号（中等）

## 核心功能

### 1. 智能搜索
- 支持股票代码搜索（如：000001）
- 支持股票名称搜索
- 支持拼音首字母搜索

### 2. 分类筛选
- 按形态类别筛选（底部反转/持续上涨/顶部反转/持续下跌/支撑）
- 按具体形态选择
- 多选支持

### 3. 彩色标注
不同类别的形态使用不同颜色标注：
- 🟢 深绿色 - 底部反转/强烈看涨
- 🟩 浅绿色 - 持续上涨
- 🔴 红色 - 顶部反转/强烈看跌
- 🟥 浅红色 - 持续下跌
- 🔵 蓝色 - 支撑信号

### 4. 交互式K线图
- ECharts专业K线图
- 支持缩放和拖动
- 自动形态标注
- 鼠标悬浮显示详情

### 5. 统计分析
- 按类别统计形态数量
- 按具体形态统计
- 详细识别结果列表

## 扩展新形态

采用装饰器模式，只需添加一个函数即可扩展新形态：

```python
# 在 patterns.py 中添加：
@recognizer.register(
    name="新形态名称",
    meaning="技术含义",
    category="底部反转",  # 或 持续上涨/顶部反转/持续下跌/支撑
    signal_type="看涨",   # 或 看跌/中性
    strength="强"         # 或 中等/弱
)
def recognize_new_pattern(df: pd.DataFrame) -> List[int]:
    """
    新形态识别逻辑

    Args:
        df: 股票数据DataFrame，包含 open, high, low, close, volume 等列

    Returns:
        识别出形态的日期索引列表
    """
    results = []

    # 实现识别逻辑
    for i in range(n, len(df)):
        # 检查形态条件
        if 满足条件:
            results.append(i)

    return results
```

系统会自动：
- 根据类别和信号类型分配颜色
- 在界面上显示新形态选项
- 在统计中包含新形态

## 技术特点

- ✅ **模块化设计** - 装饰器模式，易于扩展
- ✅ **高性能缓存** - Streamlit缓存优化
- ✅ **彩色分类** - 直观的颜色编码
- ✅ **灵活筛选** - 按类别和形态筛选
- ✅ **专业图表** - ECharts交互式K线图
- ✅ **完整日志** - 便于调试和监控
